最新说明:
@2012/10/22 18:42: 代码整理划分模块, 添加plugin回调逻辑, 提供简单的示例plugin demo, 供感兴趣的同学阅读与反馈.
@2012/10/22 18:43: 接下来会提供一个模仿Mysql的plugin demo, 向大家演示如何在框架基础上异步化阻塞操作. (本周内有空完成)
@2012/10/23 15:00: 添加Mysql Plugin, 终于给大家提供了一个生动的例子, 因为引入多Plugin, src/client.cpp, src/server.cpp中的Plugin调用逻辑出现了变动, 已经注释原因, 现在整个项目更具有可读性与实用性了, 欢迎大家找BUG提建议.

  libevent.tar.gz (6.39 KB, 下载次数: 5) 

更多关于项目更新细节的记录均在2楼记录, 欢迎追踪.

Server自带两个Plugin:
1 ) slow_query计时plugin, 将会在结果中包含请求时间, 该plugin自身将会每5秒响应一次.
2 ) fake_mysql伪装mysql query plugin, 任何请求将会阻塞5秒后才返回Mysql查询结果(伪装非常慢的Mysql查询请求).

How to use ?

1, tar -zxvf libevent.tar.gz 解压
2, make -C plugin/slow_query && make -C plugin/fake_mysql 编译两个Plugin
3, make 编译Server
4, ./server 运行

How to test ?

1, telnet localhost 10000
2, 输入你的请求, 回车结束.(可以想办法欺负Server, 使劲敲回车, 等待Server应答, Server以回车符进行拆包).



=====================================================================================================

背景: 
      XX希望用Epoll开发Server, 但业务上有很多阻塞的逻辑, 怕会阻塞Epoll, 所以不知道怎么设计比较好, 也就是知道大概要怎样, 但实际操作上又举步维艰的一种状态.
      
      比如, 老大交给他几个任务:
      1, 需要将Server接受到的请求向其他Server做转发并从其他Server读取应答后发回给Client(像反向代理一样).
      2, 需要将Client请求存入数据库, 或者从数据库中查询一些东西后返回给Client.

      XX疑惑的是, 他希望用epoll单线程, 而又不希望业务逻辑阻塞线程. 他大概知道要将业务逻辑放到线程中去阻塞的处理, 但不知道怎么融合到epoll单线程中, 有些不知所措了.

说明:
     我隔天写了一段代码, 只写了一些必要的内容, 让XX借着代码理解一下实现方式. 其实和一般的I/O复用Server开发是基本一样的, 但为了解决XX的问题, 引入状态机机制会让整个Server看起来更清晰易懂, 让Server架构和具体的业务逻辑解耦开来, 真正开发时只需要关注自己的业务逻辑, 这是非常有益处的, 同时, 也为XX解开了他最初的疑惑.

     
提示:
    基于write事件来完成轮询检查, 将业务阻塞逻辑移到独立线程处理, 用户请求在主线程与业务线程间异步传输, 是整个框架的核心思路, 不复杂, 但希望给大家学会这一点是如何简单实现的是很重要的内容.

    对于一部分质疑, 可以这么说, 万丈高楼平地起, 一个Server做好了才能做一群Server, 所以关注微架构设计是很必要的, 所以我希望大家讨论的内容是围绕核心问题的, 非常欢迎.